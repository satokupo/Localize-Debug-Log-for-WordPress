# Localize Debug Log for WordPress Phase 1残りタスク 実装計画書

## 要件定義

### 🎯 問題と修正目標

**現在の問題:**
- プラグインの基本ディレクトリ構成は確立済みだが、メインプラグインファイルが未作成
- logs/ディレクトリは手動作成済みだが、自動生成機能が未実装
- .htaccessによるセキュリティ対策が未実装
- **根本原因**: Phase 1の基盤となるファイル群が不完全で、プラグインとして機能しない状態

**修正目標:**
- WordPressプラグインとして認識・有効化可能な骨格を作成
- 外部からのログファイル直接アクセスを遮断するセキュリティ基盤を構築
- Phase 2以降の機能実装に向けた基盤ファイル群を完成

### 🔧 修正対象と方針

**作成対象ファイル:**
- **`localize-debug-log/localize-debug-log.php`**（新規作成）
  - 用途: メインプラグインファイル（プラグインヘッダーのみ・骨格作成）
- **`localize-debug-log/logs/.htaccess`**（新規作成）
  - 用途: ログファイルへの外部アクセス遮断
- **`localize-debug-log/LICENSE`**（編集）
  - 用途: All rights reserved ライセンス表記（空ファイルに内容追加）

**ファイル構造（作業対象の可視化）:**
```
localize-debug-log/
├── localize-debug-log.php           ★ 新規作成（プラグインヘッダーのみ）
├── logs/
│   ├── .htaccess                    ★ 新規作成（セキュリティ）
│   └── debug.log                    ← Phase 2で実装予定
├── readme.md                        ← 既存（完成済み）
└── LICENSE                          ★ 編集（ライセンス）
```

**実装方針:**
- **骨格レベルの実装**: プラグインヘッダーのみでWordPressに認識させる
- **Phase 2以降の機能は実装しない**: error_log出力先変更、管理画面UI、フック登録等
- **基盤ファイルの配置**: .htaccessとLICENSEファイルの作成のみ
- **WordPressコーディング規約準拠**: 将来の拡張に備えた準備

### ⚠️ 絶対変更禁止ルール

**既存ファイル保護:**
- `readme.md`の内容変更禁止（完成済みファイル）
- `_doc/`配下の設計資料変更禁止
- `dev/`配下のテスト環境設定変更禁止

**Phase範囲の厳守:**
- Phase 2以降の機能（管理画面UI、ログ表示・削除機能等）の実装禁止
- 管理画面メニュー追加機能の実装禁止（Phase 3対象）
- ログ表示・整形機能の実装禁止（Phase 2対象）

**セキュリティ要件:**
- 管理者権限チェック機能は必須実装
- ファイルアクセス制御（realpath()によるパス検証）実装必須
- CSRF対策は骨格レベルでの準備のみ（本格実装はPhase 4）

### 🧪 動作確認項目

**必須確認事項:**
1. WordPressプラグイン一覧でプラグインが認識される
2. プラグイン有効化が正常に実行できる（エラーが発生しない）
3. logs/.htaccessが存在し、外部アクセスが遮断される
4. LICENSEファイルが適切な内容で作成されている

**技術的確認:**
- プラグインヘッダー情報が正確に記載されている
- .htaccessの「Deny from all」が適切に記述されている
- LICENSEファイルの内容がreadme.mdの方針と整合している

### 📊 成功条件

**技術的成功条件:**
- WordPressがプラグインとして正常認識・有効化可能
- .htaccessによる外部アクセス遮断が機能する
- LICENSEファイルが適切に作成される
- Phase 2での機能実装に向けた基盤が整う

**ユーザー体験成功条件:**
- 管理者がプラグイン一覧から有効化できる
- 有効化時にエラーが発生しない
- ログファイルへの直接ブラウザアクセスが拒否される

---

## チェックボックス付き実装計画書

**実装計画立案ルール**

- 詳細なステップバイステップの計画書
- とにかく小さい単位
- 明確な開始と終了がある
- １つの関心事に集中

## 計画書

### 📋 Phase 1 実装チェックリスト

#### 🎯 1. メインプラグインファイル作成
- [ ] `localize-debug-log.php`の基本プラグインヘッダー記述
  - [ ] Plugin Name: Localize Debug Log for WordPress
  - [ ] Description: WordPress のタイムゾーン設定に基づいて、PHP の error_log() 出力を収集し、ローカル時間付きで表示する管理用プラグイン
  - [ ] Version: 1.0.0
  - [ ] Author: satokupo
  - [ ] Requires at least: 5.1
  - [ ] Requires PHP: 7.4
  - [ ] License: All rights reserved
- [ ] プラグインファイルの基本構造作成
  - [ ] PHPオープンタグの記述
  - [ ] defined('ABSPATH')によるセキュリティチェック
  - [ ] 関数プレフィックス「ldl_」準備のためのコメント記述
- [ ] WordPressプラグイン規約準拠確認
  - [ ] ファイル名とヘッダー情報の整合性確認
  - [ ] プラグインディレクトリ名との一致確認

#### 🔐 2. セキュリティ基盤構築
- [ ] `logs/.htaccess`ファイル作成
  - [ ] "Deny from all"ディレクティブの記述
  - [ ] Apache設定によるログファイル直接アクセス遮断
- [ ] セキュリティ設定の動作確認
  - [ ] ブラウザからlogs/ディレクトリへの直接アクセス試行
  - [ ] 403 Forbiddenエラーの確認

#### 📄 3. LICENSEファイル完成
- [ ] 既存の空LICENSEファイルに内容追加
  - [ ] 著作権表記（Copyright (c) 2025 satokupo）
  - [ ] All rights reserved宣言
  - [ ] 再配布・改変・商用利用禁止の明記
  - [ ] readme.mdのライセンス方針との整合性確認
- [ ] ライセンス内容の最終確認
  - [ ] 法的表記の適切性確認
  - [ ] タイポ・文法チェック

#### ✅ 4. 動作確認・検証
- [ ] WordPress環境での基本動作確認
  - [ ] プラグイン一覧での認識確認
  - [ ] プラグイン有効化の正常実行
  - [ ] 有効化時のエラー発生なし確認
- [ ] セキュリティ機能確認
  - [ ] logs/.htaccessによるアクセス制御確認
  - [ ] 外部からのログファイル直接アクセス遮断確認
- [ ] ファイル整合性確認
  - [ ] 全必要ファイルの存在確認
  - [ ] ファイル内容の技術仕様書準拠確認

#### 📝 5. 最終チェック・完成度確認
- [ ] Phase 1完成要件の全項目達成確認
  - [ ] プラグイン骨格の完成
  - [ ] セキュリティ基盤の構築
  - [ ] 基盤ファイル群の整備
- [ ] Phase 2準備状態の確認
  - [ ] 次フェーズでの機能実装基盤整備
  - [ ] 関数プレフィックス準備完了(ldl_ 関数プレフィックスの存在をコードコメント内で明示している)
  - [ ] ディレクトリ構造の最終確認
- [ ] プロジェクト品質チェック
  - [ ] WordPressコーディング規約準拠
  - [ ] 技術仕様書との整合性確認
  - [ ] マイルストーンとの対応確認

---
## コミットコメント

{{実装チェックリストが完了後、ユーザーの明確な承認を得たあとでチャットに出力されたコミットコメントを記載}}
