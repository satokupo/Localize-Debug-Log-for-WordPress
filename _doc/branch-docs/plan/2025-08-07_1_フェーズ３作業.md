# Phase 3: 管理画面 UI 実装 — 要件定義 (MVP)

## 🎯 概要
シングルサイト運用を前提に、管理者がログを閲覧・削除できる最小 UI を実装する。
国際化・マルチサイト対応は後続フェーズで扱う。

## 関連関数（新規）
| 関数名 | 役割 |
|--------|------|
| ldl_add_admin_menu | 設定メニューにページ追加（admin_menuフックで入口制御） |
| ldl_add_admin_bar_link | 管理バーにログ画面リンクを追加 |
| ldl_render_log_page | textareaでログ表示（esc_textarea適用）＋削除ボタン出力 |
| ldl_handle_delete_request | 削除リクエスト受付・nonce検証・削除処理呼び出し |
| ldl_delete_log_file | ログファイル削除処理（unlink）＋空のdebug.log再生成 |
| ldl_notice_delete_result | 削除成功・失敗通知をadmin_noticesで出力 |

## 📍 現状
- Phase 2 コア 14 関数完了（変更禁止）
- 開発環境：PHPUnit + WP_Mock 構築済み

## ゴール（動作レベル）
1. 「設定 › Localize Debug Log」メニューと管理バーリンクから画面に遷移できる
2. textarea に `ldl_get_formatted_log()` の出力を `esc_textarea()` 適用で表示
3. textarea は読み取り専用でコピー可能な形式で出力される
4. 削除ボタン → JS confirm → POST → `ldl_handle_delete_request()` → `ldl_delete_log_file()` でログ削除
5. 削除後は空の `debug.log` ファイルが自動的に再生成される
6. 成功 / 失敗の結果は `ldl_notice_delete_result()` によって画面上に通知される
7. 管理者以外には画面が表示されず、メニューも表示されない（入口遮断により保護）

## 技術方針
- WordPress 標準 UI＋dashicons のみ使用（独自 CSS なし）
- 削除 POST のみ nonce (`wp_nonce_field` / `check_admin_referer`) 実装
- ログは読み取り専用。ファイル名・パスは `localize-debug-log/logs/debug.log` に固定

## 成功条件（検証可能）
- メニュー・管理バーから遷移し textarea が表示される
- ローカル時刻付きログがエスケープ済みで表示される
- 1 MB 超で警告メッセージ
- 削除成功で「ログファイルを削除しました」通知、失敗で理由付き通知
- nonce 不一致・権限不足時に処理拒否＋エラーメッセージ

## 実装チェックリスト
- [ ] ldl_add_admin_menu 実装・動作確認
- [ ] ldl_add_admin_bar_link 実装・動作確認
- [ ] ldl_render_log_page 実装（`esc_textarea`）
- [ ] ldl_handle_delete_request 実装（nonce & confirm）
- [ ] ldl_delete_log_file 実装（flock は Phase-4）
- [ ] ldl_notice_delete_result 実装
- [ ] PHPUnit: Ldl_Ui_Test 作成（表示／削除／警告）


---

## チェックボックス付き実装計画書

**実装計画立案ルール**
- 詳細なステップバイステップの計画書
- とにかく小さい単位
- 明確な開始と終了がある
- １つの関心事に集中

## 計画書
{{ユーザーから要件定義の承認取得後、ここに実装計画立案}}

---

## コミットコメント
{{実装チェックリストが完了後、ユーザーの明確な承認を得たあとでチャットに出力されたコミットコメントを記載}}
