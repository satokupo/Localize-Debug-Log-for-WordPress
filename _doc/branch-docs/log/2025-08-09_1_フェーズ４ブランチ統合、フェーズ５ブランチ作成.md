# フェーズ4ブランチ統合・フェーズ5ブランチ作成フロー

## 要件定義

### 概要説明
フェーズ4（セキュリティ・権限制御）の実装が完了したため、以下の作業を順序立てて実施する：
1. **フェーズ4終了フロー**: プルリク作成・マージ・ブランチクリーンアップ
2. **フェーズ5開始フロー**: 新ブランチ作成・テスト実装・品質保証の作業環境構築

### 現在地
- **Phase 4 実装完了**: セキュリティ機能（CSRF共通化・パス検証・排他制御）実装済み
- **ブランチ**: `feature/phase4-security-permissions` 上で作業完了
- **次フェーズ**: Phase 5（テスト実装・品質保証）への移行準備

### ゴール
1. フェーズ4の成果物をmainブランチに安全に統合
2. ローカル・リモートの不要ブランチを適切に削除
3. フェーズ5作業用の新ブランチ環境を整備
4. スムーズなフェーズ移行の実現

### 方針
- **安全第一**: マージ前の最終確認を徹底
- **クリーンアップ**: 不要ブランチは速やかに削除
- **文書化**: 作業フローを明確に記載し、再現可能な手順とする
- **分離**: フェーズ4完了とフェーズ5開始を明確に分けて実施

---

## ✅ フェーズ4終了フロー（マージ・ブランチ削除）

### Step 1: 最終確認・テスト実行
- [✓] 現在のブランチが `feature/phase4-security-permissions` であることを確認
```bash
git branch
```
- [✓] 全テストがパスすることを確認
```bash
npm run test
```
- [✓] Git作業ツリーがクリーンであることを確認
```bash
git status
```

### Step 2: プルリク作成（GitHub手動操作）
- [✓] GitHubにアクセス: リポジトリページを開く
- [✓] 「Compare & pull request」または「New pull request」をクリック
- [✓] **Base**: `main` ← **Compare**: `feature/phase4-security-permissions`
- [✓] **タイトル**: `Phase 4: セキュリティ・権限制御実装`
- [✓] **説明文**: マイルストーンPhase 4項目をコピー + 実装詳細を追記
- [✓] **Draft状態なし**: すぐに「Create pull request」で本プルリク作成

### Step 3: プルリク内容確認・最終チェック
- [✓] **差分確認**: 意図しないファイル変更がないかチェック
- [✓] **コミット履歴**: 適切なコミットメッセージになっているかチェック
- [✓] **競合チェック**: マージ競合がないことを確認

### Step 4: マージ実行（GitHub手動操作）
- [✓] 「Merge pull request」をクリック
- [✓] マージコミットメッセージを確認・必要に応じて編集
- [✓] 「Confirm merge」でマージ実行
- [✓] マージ完了を確認

### Step 5: リモートブランチ削除（GitHub手動操作）
- [✓] マージ後に表示される「Delete branch」をクリック
- [✓] ブランチ削除完了を確認

### Step 6: ローカル同期・ブランチクリーンアップ
```bash
# mainブランチに切り替え
git checkout main

# 最新のmainブランチを取得
git pull origin main

# ローカルのフェーズ4ブランチを削除
git branch -d feature/phase4-security-permissions

# 削除されたことを確認
git branch
```

### Step 7: マイルストーン更新
- [✓] `_doc/_Milestone.md` のPhase 4セクションに完了チェック追加
- [✓] 完了日・ブランチ名・実装成果の記録を追記

---

## 🚀 フェーズ5開始フロー（ブランチ作成・初期設定）

### Step 1: マイルストーン確認・Phase 5要件理解
- [✓] `_doc/_Milestone.md` のPhase 5項目を確認
- [✓] `_doc/_TechSpec.md` のテスト関連要件を確認
- [✓] `_doc/_TestWorkflow.md` のテストフレームワーク要件を確認

### Step 2: リモートブランチ作成（GitHub手動操作）
- [✓] GitHubリポジトリページで「main」ブランチが選択されていることを確認
- [✓] ブランチドロップダウンをクリック
- [✓] 新ブランチ名入力: `feature/phase5-quality-assurance`
- [✓] 「Create branch: feature/phase5-quality-assurance from main」をクリック

### Step 3: ローカルブランチ作成・同期
```bash
# リモートの変更を取得
git fetch origin

# 新ブランチをローカルに作成・チェックアウト
git checkout -b feature/phase5-quality-assurance origin/feature/phase5-quality-assurance

# 正しくブランチが作成されたことを確認
git branch
```

### Step 4: 差分作成
- [ ] 何かしらの変更を行い、コミット＆プッシュ

### Step 5: ドラフトプルリク作成（GitHub手動操作）
- [ ] GitHubで「Compare & pull request」をクリック
- [ ] **タイトル**: `[DRAFT] Phase 5: テスト実装・品質保証`
- [ ] **説明文**: Phase 5マイルストーン項目を記載
- [ ] 「Create draft pull request」でドラフト作成

