# テスト環境README修正計画

## 要件定義

### 1. 修正の目的
PHPUnit機能移設（`localize-debug-log/` → `dev/`）に伴い、`dev/tests/_README.md`の内容を新しいプロジェクト構造に対応させる

### 2. 現在の問題点
`dev/tests/_README.md`の内容が移設前の構造を前提としており、以下の点で実情と乖離している：

#### 2-1. 初回セットアップ手順
- 現在：プロジェクトルートでの作業を前提とした記述
- 実際：`dev/`ディレクトリでの作業が必要

#### 2-2. 実行コマンド記載
- 現在：`composer test`コマンドのみ記載
- 実際：`npm run test`（ルートから）と`composer test`（dev/から）の2つの実行方法が利用可能

#### 2-3. 運用フローの説明
- 現在：composer前提の説明
- 実際：package.json + npm scriptsによるショートカット実行が推奨

### 3. 修正対象箇所

#### 3-1. 初回セットアップ手順セクション
- `dev/`ディレクトリでの作業を明記
- プロジェクトルートの`package.json`についての説明追加

#### 3-2. 実行コマンド一覧セクション
- npm runコマンドの追加（推奨方法として）
- 実行場所（ルート vs dev/）の明記
- PowerShell対応について補足

#### 3-3. 日常的な開発フローセクション
- ルートからの`npm run test`を推奨実行方法として追記
- `cd dev && composer test`は補助的な方法として記載

### 4. 新たに追加する内容

#### 4-1. プロジェクト構造説明
```
プロジェクトルート/
├── package.json          # npm scripts（推奨実行方法）
├── dev/                  # 開発・テスト環境
│   ├── composer.json     # PHP依存関係管理
│   ├── phpunit.xml       # テスト設定
│   └── tests/            # テストファイル群
└── localize-debug-log/   # プラグイン本体
```

#### 4-2. 実行方法の使い分け
- **推奨**: ルートから`npm run test`（ショートカット）
- **従来**: dev/から`composer test`（直接実行）

#### 4-3. PowerShell環境での注意点
- `cmd /c`使用による`&&`記号対応

### 5. 修正方針
- 既存の有用な情報（ディレクトリ構造、運用ルールなど）は維持
- 新しいプロジェクト構造に合わせて実行コマンド部分を更新
- 初心者にも分かりやすい構成で推奨実行方法を明記
- 従来の方法も残して選択肢を提供

---

## チェックボックス付き実装計画書

**実装計画立案ルール**

- 詳細なステップバイステップの計画書
- とにかく小さい単位
- 明確な開始と終了がある
- １つの関心事に集中

## 計画書

### フェーズ1: 現在のファイル内容確認
- [x] 1-1. `dev/tests/_README.md` の現在の内容を確認する
**作業報告**: ファイル読み込み完了。199行、各セクションの構成と内容を把握

- [x] 1-2. 修正対象セクションの特定と現在の記述内容を把握する
**作業報告**: 修正対象セクション特定完了
- 初回セットアップ手順（3-25行目）- dev/ディレクトリでの作業明記が必要
- 実行コマンド一覧（94-102行目）- npm runコマンド追加が必要
- Composer.jsonスクリプト設定（80-92行目）- package.json追加が必要
- 日常的な開発フロー（128-142行目）- npm run test推奨への変更が必要
- トラブルシューティング（186-199行目）- npm run関連追加が必要

- [x] 1-3. 既存の有用な情報で維持すべき箇所をリストアップする
**作業報告**: 維持すべき箇所特定完了
- 各ディレクトリの用途説明（47-78行目）✓
- テストファイルの移動タイミング（106-127行目）✓
- ファイル管理のベストプラクティス（149-173行目）✓
- ディレクトリ移動時の注意点（174-184行目）✓

### フェーズ2: プロジェクト構造説明の追加
- [x] 2-1. "## ファイル構成" セクションの前に新しいセクション "## プロジェクト全体構造" を追加する
**作業報告**: 新セクション追加完了（26行目に挿入）

- [x] 2-2. 移設後の全体ディレクトリ構造図を記載する
**作業報告**: ディレクトリ構造図作成完了。プロジェクトルート、dev/、localize-debug-log/の階層構造を明記

- [x] 2-3. 各ディレクトリの役割（ルート、dev/、localize-debug-log/）を説明する
**作業報告**: 各ディレクトリの役割テーブル作成完了。実行コマンドも併記

- [x] 2-4. package.json と composer.json の関係性を説明する
**作業報告**: 設定ファイルの関係性セクション追加完了。npm scripts → composer実行の流れを説明

### フェーズ3: 初回セットアップ手順の修正
- [x] 3-1. "### 新規プロジェクトでの環境構築" の1番「Composerインストール」を確認する
**作業報告**: 1番の内容確認済み。変更不要（Composerインストール手順は共通）

- [x] 3-2. 2番「composer.json編集」の作業場所を `dev/` ディレクトリと明記する
**作業報告**: 修正完了。「dev/composer.json編集」とタイトル変更、作業場所を明記

- [x] 3-3. 3番「PHPUnitインストール」のコマンド実行場所を `dev/` と明記する
**作業報告**: 修正完了。`cd dev && composer install` に変更

- [x] 3-4. 4番「ディレクトリ作成」の作業場所を `dev/tests/` と修正する
**作業報告**: 修正完了。全パスを `dev/tests/` プレフィックス付きに変更

- [x] 3-5. 5番「設定ファイル作成」の配置場所を明確化する
**作業報告**: 修正完了。`dev/phpunit.xml`, `dev/tests/bootstrap.php` と明記

- [x] 3-6. 新たに6番として「ルートpackage.json作成」の手順を追加する
**作業報告**: 新項目追加完了。PowerShell対応の`cmd /c`形式でスクリプト例も記載

### フェーズ4: 実行コマンド一覧の修正
- [x] 4-1. "## 実行コマンド一覧" セクションのテーブルを確認する
**作業報告**: 現在のテーブル確認完了（145行目のセクション）

- [x] 4-2. 現在のテーブルの上に "### 推奨実行方法（ルートから）" セクションを追加する
**作業報告**: 新サブセクション追加完了（147行目）

- [x] 4-3. npm run コマンドのテーブルを新規作成する
**作業報告**: npm runコマンドテーブル作成完了。4つのコマンド（test, test-active, test-all, test-pending）を記載

- [x] 4-4. 既存のテーブルタイトルを "### 直接実行方法（dev/から）" に変更する
**作業報告**: 既存テーブルのタイトル変更完了（158行目）

- [x] 4-5. PowerShell環境での注意点を補足として追加する
**作業報告**: PowerShell対応の注意書き追加完了（156行目）

### フェーズ5: 日常的な開発フローの修正
- [x] 5-1. "### 🔄 日常的な開発フロー" セクションを特定する
**作業報告**: セクション特定完了（192行目）

- [x] 5-2. 1番「通常の開発中」のコマンド例を `npm run test` に変更する
**作業報告**: 修正完了。`npm run test`を推奨として記載

- [x] 5-3. 従来の `composer test` は「または」として併記する
**作業報告**: 併記完了。`cd dev && composer test`を直接実行として追記

- [x] 5-4. 3番「リリース前確認」のコマンド例を `npm run test-all` に変更する
**作業報告**: 修正完了。`npm run test-all`を推奨として記載

- [x] 5-5. 従来の `composer test-all` は「または」として併記する
**作業報告**: 併記完了。`cd dev && composer test-all`を直接実行として追記。2番の新機能テスト作成のパスも`dev/tests/active/`に修正済み

### フェーズ6: Composer.jsonスクリプト設定セクションの修正
- [x] 6-1. "## Composer.jsonスクリプト設定" セクションを特定する
**作業報告**: セクション特定完了（131行目）

- [x] 6-2. セクションタイトルを "## スクリプト設定" に変更する
**作業報告**: タイトル変更完了

- [x] 6-3. "### dev/composer.json" のサブセクションを追加する
**作業報告**: サブセクション追加完了（133行目）

- [x] 6-4. 既存のJSONコードブロックの上に説明文を追加する
**作業報告**: 説明文追加完了。「PHPUnitの依存関係とテストスクリプト定義」

- [x] 6-5. "### package.json（ルート）" のサブセクションを新規追加する
**作業報告**: 新サブセクション追加完了（149行目）

- [x] 6-6. package.jsonのスクリプト設定例を追加する
**作業報告**: package.jsonの設定例追加完了。説明文「npm scriptsによるショートカット実行（推奨）」も併記

### フェーズ7: 新しい運用ルールの追加
- [x] 7-1. "## 運用ルール" セクション内に新しいサブセクション "### 💻 実行環境の選択" を追加する
**作業報告**: 新サブセクション追加完了（191行目）

- [x] 7-2. 推奨実行方法（npm run）の利点を記載する
**作業報告**: 利点リスト作成完了。ワンコマンド実行、環境統一、PowerShell対応、統合性の4点を記載

- [x] 7-3. 直接実行方法（composer）を使う場面を記載する
**作業報告**: 使用場面リスト作成完了。デバッグ、IDE連携、学習目的、トラブルシューティングの4場面を記載

- [x] 7-4. 環境による違い（PowerShell対応）について説明する
**作業報告**: 環境別対応表作成完了。Windows PowerShell、Windows CMD、Linux/Macでの推奨方法と注意点を整理

### フェーズ8: トラブルシューティングの更新
- [x] 8-1. "## トラブルシューティング" セクションを確認する
**作業報告**: セクション特定完了（297行目）

- [x] 8-2. 新しい問題項目 "### npm run test でエラーが発生する" を追加する
**作業報告**: 新項目追加完了（299行目）

- [x] 8-3. PowerShell環境での問題と解決策を記載する
**作業報告**: PowerShell問題の説明追加完了。症状、原因、解決策を詳細記載

- [x] 8-4. package.json の設定確認方法を記載する
**作業報告**: 設定確認セクション追加完了。確認コマンドと正しい設定例を記載。Node.js/npm環境確認、dev/ディレクトリ確認も追記

### フェーズ9: 最終確認と整合性チェック
- [x] 9-1. 修正した内容が要件定義と一致しているか確認する
**作業報告**: 要件定義との一致確認完了
- ✅ 初回セットアップ手順: dev/ディレクトリでの作業明記済み
- ✅ 実行コマンド記載: npm runコマンド追加済み（推奨実行方法として）
- ✅ 運用フロー説明: npm scripts推奨への変更済み
- ✅ プロジェクト構造説明: 全体図と関係性の説明追加済み
- ✅ PowerShell対応: トラブルシューティングに詳細追加済み

- [x] 9-2. 既存の有用な情報が適切に保持されているか確認する
**作業報告**: 既存情報の保持確認完了
- ✅ 各ディレクトリの用途説明（active/, archive/, pending/）維持
- ✅ テストファイルの移動タイミング説明維持
- ✅ ファイル管理のベストプラクティス維持
- ✅ ディレクトリ移動時の注意点維持

- [x] 9-3. 新旧の実行方法が適切に併記されているか確認する
**作業報告**: 実行方法併記確認完了
- ✅ 実行コマンド一覧: 推奨（npm run）と直接（composer）を分けて記載
- ✅ 日常的な開発フロー: 「推奨」と「または」で併記
- ✅ 運用ルール: 実行環境選択の指針追加
- ✅ スクリプト設定: package.jsonとcomposer.json両方を説明

- [x] 9-4. 文章の流れと可読性をチェックする
**作業報告**: 可読性確認完了
- ✅ プロジェクト全体構造 → セットアップ → 実行方法 → 運用ルールの論理的な流れ
- ✅ 各セクションに適切な見出しとアイコン使用
- ✅ テーブルとコードブロックで情報を整理

- [x] 9-5. マークダウンの記法が正しいかチェックする
**作業報告**: マークダウン記法確認完了
- ✅ 見出し階層が適切（##, ###, ####）
- ✅ テーブル記法が正しい
- ✅ コードブロックが適切に設定（json, bash）
- ✅ リストのインデントが統一

---
## コミットコメント

```
docs: PHPUnit移設に伴うテスト環境READMEを更新

- プロジェクト全体構造の説明を追加
  - 移設後のディレクトリ構成図
  - 各ディレクトリの役割と実行コマンド対応表
  - package.jsonとcomposer.jsonの関係性説明
- 初回セットアップ手順をdev/環境に対応
  - 作業場所をdev/ディレクトリと明記
  - ルートpackage.json作成手順を追加
  - PowerShell対応のcmd /c形式を採用
- 実行コマンド一覧を推奨/直接実行に分離
  - npm run（推奨）とcomposer（直接）を併記
  - PowerShell環境での注意点を補足
- 日常的な開発フローを更新
  - npm run testを推奨実行方法に変更
  - 従来のcomposer testも選択肢として併記
- スクリプト設定説明を拡充
  - dev/composer.jsonとpackage.jsonの両方を説明
  - 各設定ファイルの役割を明確化
- 新しい運用ルール「実行環境の選択」を追加
  - 推奨/直接実行の使い分け指針
  - 環境別（PowerShell/CMD/Linux）の対応表
- トラブルシューティングを強化
  - npm run testエラー対応を追加
  - PowerShell問題の詳細解決策
  - package.json設定確認方法
- 既存の有用情報を維持
  - ディレクトリ用途、移動タイミング等は保持
```
